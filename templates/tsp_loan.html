{% extends "base.html" %}
{% block title %}TSP Loan Calculator{% endblock %}
{% block content %}
<h2 class="mb-3">TSP Loan Calculator ðŸ’µ</h2>

{% if not result %}
<form method="POST" class="mb-4 needs-validation" novalidate>
  <div class="row g-3">

    <!-- Loan Type -->
    <div class="col-md-6">
      <label class="form-label">Loan Type</label><br>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="loan_type" value="general"
               {% if values.get('loan_type', 'general') == 'general' %}checked{% endif %}>
        <label class="form-check-label">General</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="loan_type" value="residential"
               {% if values.get('loan_type') == 'residential' %}checked{% endif %}>
        <label class="form-check-label">Primary Residence</label>
      </div>
    </div>

    <!-- TSP Balance -->
    <div class="col-md-6">
      <label class="form-label">TSP Balance ($)</label>
      <input type="number" class="form-control" name="tsp_balance"
             min="100" max="1000000"
             title="Your current TSP account balance ($100 â€“ $1,000,000)"
             value="{{ values.get('tsp_balance', '') }}" required>
      <div class="invalid-feedback">Enter a valid balance between $100 and $1,000,000.</div>
    </div>

    <!-- Loan Amount -->
    <div class="col-md-6">
      <label class="form-label">Loan Amount ($)</label>
      <input type="number" class="form-control" name="loan_amount"
             min="100" max="50000"
             title="Maximum TSP loan amount is $50,000"
             value="{{ values.get('loan_amount', '') }}" required>
      <div class="invalid-feedback">Max loan amount is $50,000.</div>
    </div>

    <!-- Loan Interest Rate -->
    <div class="col-md-6">
      <label class="form-label">Loan Interest Rate (%)</label>
      <input type="number" class="form-control" name="loan_interest_rate"
             step="0.01" min="0" max="15"
             title="Typical TSP loan interest is 3â€“5%. Max allowed: 15%"
             value="{{ values.get('loan_interest_rate', '') }}" required>
      <div class="invalid-feedback">Enter an interest rate between 0% and 15%.</div>
    </div>

    <!-- Expected Market Growth -->
    <div class="col-md-6">
      <label class="form-label">Expected Market Growth (%)</label>
      <input type="number" class="form-control" name="expected_annual_growth"
             step="0.01" min="0" max="15"
             title="Estimated TSP annual return (e.g., 5â€“10%). Max: 15%"
             value="{{ values.get('expected_annual_growth', '') }}" required>
      <div class="invalid-feedback">Enter a growth rate between 0% and 15%.</div>
    </div>

    <!-- Pay Periods -->
    <div class="col-md-6">
      <label class="form-label">Number of Pay Periods</label>
      <input type="number" class="form-control" name="num_pay_periods"
             min="1" max="1300"
             title="Biweekly periods: 26 = 1 year, 130 = 5 years, 1300 = 50 years"
             value="{{ values.get('num_pay_periods', '') }}" required>
      <div class="invalid-feedback">Number must be between 1 and 1300.</div>
    </div>

    <!-- Biweekly Contributions -->
    <div class="col-12">
      <fieldset class="border rounded p-3 mt-3">
        <legend class="w-auto px-2 fw-bold">Biweekly Contributions + Match</legend>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Biweekly Contribution (No Loan)</label>
            <small class="form-text text-muted">Your regular contribution if you donâ€™t borrow from TSP.</small>
            <input type="number" class="form-control" name="biweekly_contribution_no_loan"
                   min="0" max="2000"
                   title="Typical total contributions per paycheck. Max $2,000."
                   value="{{ values.get('biweekly_contribution_no_loan', '') }}" required>
            <div class="invalid-feedback">Enter an amount up to $2,000.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Biweekly Contribution (With Loan)</label>
            <small class="form-text text-muted">Your adjusted contribution while repaying the loan.</small>
            <input type="number" class="form-control" name="biweekly_contribution_during_loan"
                   min="0" max="2000"
                   title="Your reduced TSP contribution while repaying the loan. Max $2,000."
                   value="{{ values.get('biweekly_contribution_during_loan', '') }}" required>
            <div class="invalid-feedback">Enter an amount up to $2,000.</div>
          </div>
        </div>
      </fieldset>
    </div>
  </div>

  <!-- Submit Buttons -->
  <div class="d-grid gap-2 d-md-flex justify-content-md-start mt-4">
    <button type="submit" class="btn btn-primary">Calculate</button>
    <a href="/" class="btn btn-outline-secondary">Back to Home</a>
  </div>
</form>

<!-- Tooltip Style Validation Script -->
<script>
(function () {
  'use strict';
  const forms = document.querySelectorAll('.needs-validation');
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', e => {
      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
})();
</script>

{% else %}
  {% include 'result_tsp_loan.html' %}
{% endif %}